{% extends '::base.html.twig' %}

{% block stylesheets %}
    {{ parent() }}
    <link href="{{ asset('css/bootstrap-switch.min.css') }}" type="text/css" rel="stylesheet" />
    <link href="{{ asset('angular-plugins/ng-tags-input.min.css') }}" type="text/css" rel="stylesheet" />
    
    <link href="{{ asset('css/fileinput.min.css') }}" media="all" rel="stylesheet" type="text/css" />

{% endblock %} 

{% block body %}

    <div ng-controller="inputTegController as ctrl">
        <h1>Nuevo Trabajo Especial de Grado</h1>
        {{ form_start(form, { 'name': 'formInputTeg' }) }}

            {{ form_errors(form) }}
    <ul class="nav nav-tabs">
        <li class="active"><a data-toggle="tab" href="#paso1">Paso 1</a></li>
        <li><a data-toggle="tab" href="#paso2">Paso 2</a></li>
        <li><a data-toggle="tab" href="#paso3">Paso 3</a></li>
    </ul>
    <div class="tab-content">
        <div id="paso1" class="tab-pane fade in active">

            <div class="form-group">
                {{ form_label(form.titulo) }}
                {{ form_errors(form.titulo) }}
                <div class="col-xs-9 col-lg-12">
                    {{ form_widget(form.titulo) }}
                </div>
            </div>

            <div class="form-group col-lg-6">
                {{ form_label(form.authors) }}
                <div id="form-autor" class="col-xs-9">
                    <ul id="autor-fields-list" class="list-unstyled" ng-init="{% for i in form.authors %}addA('{{ i.vars.value}}');{% endfor %}">
                        <li>
                            {{ form_widget(form.authors[0].name) }}
                            {{ form_widget(form.authors[0].lastname) }}
                            {{ form_errors(form.authors[0]) }}
                        </li>

                        <label>Segundo autor (Opcional): <input type="checkbox" ng-model="segundoA" {% if form.authors[1] is defined %}ng-init="segundoA=true"{% endif %} /></label><br/>
                       
                        <li ng-if="segundoA" >
                            {% if form.authors[1] is defined %}
                            {{ form_widget(form.authors[1].name) }}
                            {{ form_widget(form.authors[1].lastname) }}
                            {{ form_errors(form.authors[1]) }}
                            {% else %}
                            <input type="text" id="biblioteca_tegbundle_teg_authors_1_name" name="biblioteca_tegbundle_teg[authors][1][name]" required="required" class="form-control" placeholder="Nombre">
                            <input type="text" id="biblioteca_tegbundle_teg_authors_1_lastname" name="biblioteca_tegbundle_teg[authors][1][lastname]" required="required" class="form-control" placeholder="Apellido">
                            {% endif %}
                        </li>
                    </ul>
                </div>
            </div>
            <div class="form-group col-lg-6">
                {{ form_label(form.tuthors) }}
                <div id="form-tutor" class="col-xs-9">

                    <ul id="tutor-fields-list" class="list-unstyled" ng-init="{% for i in form.tuthors %}addA('{{ i.vars.value}}');{% endfor %}">
                        <li>
                            {{ form_widget(form.tuthors[0].name) }}
                            {{ form_widget(form.tuthors[0].lastname) }}
                            {{ form_errors(form.tuthors[0]) }}
                        </li>
                        <label>Segundo tutor (Opcional): <input type="checkbox" ng-model="segundoT" {% if form.tuthors[1] is defined %}ng-init="segundoT=true"{% endif %} /></label><br/>
                       
                        <li ng-if="segundoT" >
                            {% if form.tuthors[1] is defined %}
                            {{ form_widget(form.tuthors[1].name) }}
                            {{ form_widget(form.tuthors[1].lastname) }}
                            {{ form_errors(form.tuthors[1]) }}
                            {% else %}
                            <input type="text" id="biblioteca_tegbundle_teg_tuthors_1_name" name="biblioteca_tegbundle_teg[tuthors][1][name]" required="required" class="form-control" placeholder="Nombre">
                            <input type="text" id="biblioteca_tegbundle_teg_tuthors_1_lastname" name="biblioteca_tegbundle_teg[tuthors][1][lastname]" required="required" class="form-control" placeholder="Apellido">
                            {% endif %}
                        </li>
                    </ul>
                </div>
            </div>

            <div class="form-group col-lg-6">
                {{ form_label(form.resumen) }}
                {{ form_errors(form.resumen) }}
                <div class="col-xs-9">
                    {{ form_widget(form.resumen) }}
                </div>
            </div>
            
            <div class="form-group col-lg-6">
                {{ form_label(form.keyWords) }}
                {{ form_errors(form.keyWords) }}

                <div class="col-xs-9" ng-init="{% for i in form.keyWords %}add('{{ i.vars.value}}');{% endfor %}">
                    <tags-input ng-model="keyWords" display-property="name" placeholder="Agregar palabra" template="tagtemplate" add-on-blur="false" min-tags="3" max-tags="15" enable-editing-last-tag="true" replace-spaces-with-dashes="false" max-length="30"></tags-input>
                    <script type="text/ng-template" id="tagtemplate">
                      <div class="tag-template">
                        <div>
                          <input type="text" name="[['biblioteca_tegbundle_teg[keyWords]['+$index+'][keyWord]']]" value="[[$getDisplayText()]]" required="required" readonly style="line-height: initial;  background: rgba(255, 255, 255, 0);border: none;width: [[$getDisplayText().length * 8]]px;"/>
                          <a class="remove-button" ng-click="$removeTag()">&#10006;</a>
                        </div>
                      </div>
                    </script>
                </div>
            </div>
            <div class="form-group col-lg-6">
                {{ form_label(form.publicacion) }}
                {{ form_errors(form.publicacion) }}
                
                {% for Field in form.publicacion %}
                    <div class="col-md-2 col-xs-3 col-lg-3" ng-init="{{Field.vars.id}}='{{Field.vars.value}}';">
                        {{ form_errors(Field) }}
                        {{ form_widget(Field, { 'attr': {'class': 'form-control form-compacto', 'ng-model':(Field.vars.id)} }) }}
                    </div>
                {% endfor %}
            </div>

            <div class="form-group col-lg-6">
                {{ form_label(form.escuela) }}
                {{ form_errors(form.escuela) }}
                <div class="col-xs-9" ng-init="{{form.escuela.vars.id}}='{{form.escuela.vars.value}}';">
                    {{ form_widget(form.escuela, { 'attr': {'ng-model':(form.escuela.vars.id)} }) }}
                </div>
            </div>
            
        </div>
        <div id="paso2" class="tab-pane fade">
            <div class="form-group">
                {{ form_label(form.capitulos) }}
                {{ form_errors(form.capitulos) }}
                
                <div class="row">
                        {% for capField in form.capitulos %}
                                {{ form_errors(capField) }}
                                {{ form_widget(capField, { 'attr': {'class': 'col-lg-3 col-md-3 col-xs-6', 'ng-model':(capField.vars.id)} }) }}
                                <h1>{# { capField.vars.value } #}</h1>
                        {% endfor %}
                </div>
            </div>
        </div>
        <div id="paso3" class="tab-pane fade">
            <div class="form-group" >
                {{ form_label(form.cota) }}
                {{ form_errors(form.cota) }}
                
                <div class="col-lg-2 col-md-3 col-xs-12" ng-init="initCota('{{form.cota.vars.value}}');">
                    <div class="input-group">
                        <span class="input-group-addon">[[cota_school]]</span>
                        <input type="number" string-to-number min="1" max="99" placeholder="Indice" ng-model="cota_index" required="required" class="form-control" style="width: initial;">
                        <span id="cota_year" class="input-group-addon">/[[cota_year]]</span>
                    </div>
                </div>
                {{ form_widget(form.cota, { 'attr': { 'ng-model':'cota','style':'display:none'} }) }}
            </div>
            
            <div class="form-group">
                
                {{ form_errors(form.published) }}
                <div class="col-xs-offset-3 col-xs-9">
                    {{ form_widget(form.published) }}
                    {{ form_label(form.published) }}
                </div>
            </div>
            <div class="form-group">
                <div class="col-xs-offset-3 col-xs-9">
                    {{ form_widget(form.submit) }}
                    {{ form_widget(form.reset) }}
                </div>
            </div>
        </div>
    </div>
      
    {{ form_widget(form._token) }}
    {{ form_end(form, {'render_rest': false} ) }}

        <ul class="record_actions">
            <li>
                <a href="{{ path('teg') }}">
                    Back to the list
                </a>
            </li>
        </ul>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    
    <script src="{{ asset('js/bootstrap-switch.min.js') }}" type="text/javascript"></script>
    <script type="text/javascript">$("[name='biblioteca_tegbundle_teg[published]']").bootstrapSwitch();</script>
   
    <script src="{{ asset('js/fileinput.js') }}" type="text/javascript"></script>
    <script src="{{ asset('js/fileinput_locale_es.js') }}" type="text/javascript"></script>

    <script src="{{ asset('js/tegController.js') }}" type="text/javascript"></script>
    <script src="{{ asset('angular-plugins/ng-tags-input.min.js') }}" type="text/javascript"></script>
        
{% endblock %}

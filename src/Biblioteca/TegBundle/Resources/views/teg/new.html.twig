{% extends '::base.html.twig' %}

{% block stylesheets %}
	{{ parent() }}
    <link href="{{ asset('css/bootstrap-switch.min.css') }}" type="text/css" rel="stylesheet" />
    
    <link href="{{ asset('css/fileinput.min.css') }}" media="all" rel="stylesheet" type="text/css" />
    <link href="{{ asset('css/fileinput.css') }}" media="all" rel="stylesheet" type="text/css" />

{% endblock %} 

{% block body -%}
    <h1>Nuevo Trabajo Especial de Grado</h1>
    {{ form_start(form) }}

    	{{ form_errors(form) }}
 
	    <div class="form-group">
	        {{ form_label(form.publicacion) }}
	        {{ form_errors(form.publicacion) }}
            {% for Field in form.publicacion %}
                <div class="col-xs-3">
                    {{ form_errors(Field) }}
                    {{ form_widget(Field, { 'attr': {'class': 'form-control'} }) }}
                </div>
            {% endfor %}
	    </div>

	    <div class="form-group">
            {{ form_label(form.escuela) }}
            {{ form_errors(form.escuela) }}
            <div class="col-xs-9">
                {{ form_widget(form.escuela) }}
            </div>
        </div>
        
        <div class="form-group">
            {{ form_label(form.cota) }}
            {{ form_errors(form.cota) }}
            <div class="col-xs-9">
  				<div class="input-group">
                	<span id="cota_escuela" class="input-group-addon">D[Escuela]</span>
                 	<input type="number" placeholder="Indice" id="biblioteca_tegbundle_teg_cota_index" required="required" class="form-control" min="1" max="99">
                	<span id="cota_year" class="input-group-addon">[Año de Publicación]</span>
            	</div>
            </div>
            <div class="col-xs-6">
                {{ form_widget(form.cota, { 'attr': {'style': 'display:none'} }) }}
            </div>
        </div>

	    <div class="form-group">
            {{ form_label(form.titulo) }}
            {{ form_errors(form.titulo) }}
            <div class="col-xs-9">
                {{ form_widget(form.titulo) }}
            </div>
        </div>
	    
	    <div class="form-group">
            {{ form_label(form.autores) }}
            {{ form_errors(form.autores) }}
            <div id="form-autor" class="col-xs-9">

    		    <ul id="autor-fields-list" class="list-unstyled" data-prototype="{{ form_widget(form.autores.vars.prototype) | e }}">
    			    {% for autorField in form.autores %}
    			        <li>
    			            {{ form_errors(autorField) }}
    			            {{ form_widget(autorField) }}
    			        </li>
    			    {% endfor %}
    		    </ul>
                <a class="btn btn-success btn-sm" href="#" id="other-autor"><span class="glyphicon glyphicon-plus-sign"></span> Agregar Autor</a>
            </div>
		</div>

        <div class="form-group">
            {{ form_label(form.resumen) }}
            {{ form_errors(form.resumen) }}
            <div class="col-xs-9">
                {{ form_widget(form.resumen) }}
            </div>
        </div>
	    
	    <div class="form-group">
            {{ form_label(form.palabrasClave) }}
            {{ form_errors(form.palabrasClave) }}
            
		    <div class="col-xs-9">
                <ul id="word-fields-list" class="list-unstyled" data-prototype="{{ form_widget(form.palabrasClave.vars.prototype) | e }}">
    			    {% for palabraField in form.palabrasClave %}
    			        <li>
    			            {{ form_errors(palabraField) }}
    			            {{ form_widget(palabraField) }}
    			        </li>
    			    {% endfor %}
                </ul>
                <a class="btn btn-success btn-sm" href="#" id="add-another-word"><span class="glyphicon glyphicon-plus-sign"></span> Agregar otra palabra clave</a>

            </div>
		</div>
        <div class="form-group">
            {{ form_label(form.capitulos) }}
            {{ form_errors(form.capitulos) }}
            
            <div class="col-xs-9">
                <ul id="cap-fields-list" class="list-unstyled" data-prototype="{ { form_widget(form.capitulos.vars.prototype) | e } }">
                    {% for capField in form.capitulos %}
                        <li>
                            {{ form_errors(capField) }}
                            {{ form_widget(capField) }}
                        </li>
                    {% endfor %}
                </ul>
                <a class="btn btn-success btn-sm" href="#" id="add-another-cap"><span class="glyphicon glyphicon-plus-sign"></span> Agregar otro archivo</a>
            </div>
        </div>

        <div class="form-group">
            
            {{ form_errors(form.published) }}
            <div class="col-xs-offset-3 col-xs-9">
                {{ form_widget(form.published) }}{{ form_label(form.published) }}
            </div>
        </div>
        <div class="form-group">
            <div class="col-xs-offset-3 col-xs-9">
                
            </div>
        </div>
 
	{{ form_end(form) }}

<ul class="record_actions">
    <li>
        <a href="{{ path('teg') }}">
            Back to the list
        </a>
    </li>
</ul>
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/bootstrap-switch.min.js') }}" type="text/javascript"></script>
    
    <script src="{{ asset('js/fileinput.js') }}" type="text/javascript"></script>
    <script src="{{ asset('js/fileinput_locale_es.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
    
    $("[name='biblioteca_tegbundle_teg[published]']").bootstrapSwitch();
	
	$('#biblioteca_tegbundle_teg_capitulos_0_file').fileinput({
        language: 'es',
        uploadUrl: '#',
        allowedFileExtensions : ['pdf'],
        showUpload: false,

    });
    $('#biblioteca_tegbundle_teg_capitulos_1_file').fileinput({
        language: 'es',
        uploadUrl: '#',
        allowedFileExtensions : ['pdf'],
        showUpload: false,

    });

    jQuery(document).ready(function() {

        // realiza un seguimiento de cuántos campos de autores y palabras clave se han pintado
        var wordsCount = '{{ form.palabrasClave | length }}';
        var autoresCount = '{{ form.autores | length }}';
    
        jQuery('#other-autor').click(
            function() {
                if(autoresCount == 1)
                {
                    /* Get Object List Autor */
                    var autorList = jQuery('#autor-fields-list');
                    /* Get prototype li */
                    var newWidget = autorList.attr('data-prototype');

                    newWidget = newWidget.replace("__name__", autoresCount);
                    newWidget = newWidget.replace("__name__", autoresCount);
                    autoresCount++;

                    // Crea un nuevo elemento lista
                    var newLi = jQuery('<li id="2" class="input-group"></li>').html(newWidget);
                    // El elemento lo añade a la lista
                    newLi.appendTo(autorList);
                    //cambiar nombre de etiqueta
                    $("#other-autor").html("<span class='glyphicon glyphicon-remove-sign'></span> Quitar");
                    $("#other-autor").attr("class", "input-group-addon btn btn-danger btn-sm");
                    $("#other-autor").appendTo(newLi);
                }
                else
                {
                    autoresCount--;
                    
                    //Cambiar nombre de etiqueta
                    $("#other-autor").html("<span class='glyphicon glyphicon-plus-sign'></span> Agregar Autor");
                    $("#other-autor").attr("class", "btn btn-success btn-sm");
                    // Se mueve al ul
                    $("#other-autor").appendTo("#form-autor");
                    // Se remueve li 2
                    $('#autor-fields-list #2').remove();
                }
                return false;
            }
        );

        jQuery('#add-another-word').click( 
            function() {
				/* Get Object List Word */
                var wordList = jQuery('#word-fields-list');
            	
            	if(wordsCount == 3)
            	{
            		var remove_btn= jQuery('<a id="remove-word" name="remove-word"class="input-group-addon btn btn-danger btn-sm" href="#" ></a>');
            		remove_btn.html('<span class="glyphicon glyphicon-remove-sign"></span> Quitar');
            		remove_btn.click(
			  	     	function(){
			               	wordsCount--;
			            	
			                //Cambiar clase de li anterior
			                $('[id*="word-'+wordsCount+'"]').attr("class", "input-group");
			                // Se mueve al li anterior
			                $("#remove-word").appendTo($('[id*="word-'+wordsCount+'"]'));
			                // Se remueve li actual
			                $('[id*="word-'+(wordsCount+1)+'"]').remove();

			                if(wordsCount == 3)
			            	{
			            		$('#remove-word').remove();
			            	}
			            	return false;
			            }
        			);
            		remove_btn.appendTo(wordList);	
            	}
               
                /* Get prototype li */
                var newWidget = wordList.attr('data-prototype');

                newWidget = newWidget.replace("__name__", wordsCount);
                newWidget = newWidget.replace("__name__", wordsCount);
                
                // Cambia clase de li anterior

                $('[id*="word-'+wordsCount+'"]').attr("class", null);

                wordsCount++;

                // Crea un nuevo elemento lista
                var newLi = jQuery('<li id="word-'+wordsCount+'" class="input-group"></li>').html(newWidget);
                // El elemento lo añade a la lista
                newLi.appendTo(wordList);

                //Mover boton de quitar a nuevo objeto li
                $("#remove-word").appendTo(newLi);
                
                return false;
            }
        );

        // Generar Cota
        $('#biblioteca_tegbundle_teg_publicacion_year,#biblioteca_tegbundle_teg_escuela,#biblioteca_tegbundle_teg_cota_index').change(function(){
        
	//            alert($('#biblioteca_tegbundle_teg_publicacion_year').val());
  	//          alert($('#biblioteca_tegbundle_teg_escuela').val());
    //        alert($('#biblioteca_tegbundle_teg_cota_index').val());
            if($('#biblioteca_tegbundle_teg_publicacion_year').val() == 0)
            {
                var prev_cota_year = "[Año de Publicación]";
            }
            else
            {
                var prev_cota_year = (("0" + ($('#biblioteca_tegbundle_teg_publicacion_year').val() % 100) ).slice (-2));
            }
        
            if($('#biblioteca_tegbundle_teg_escuela').val() == 0)
            {
                var prev_cota_escuela = "[Escuela]";
            }
            else
            {
                var prev_cota_escuela = $('#biblioteca_tegbundle_teg_escuela').val().charAt(0);
            }

            if($('#biblioteca_tegbundle_teg_cota_index').val() <= 0)
            {
                var prev_cota_index = "[indice]";
            }
            else
            {
                var prev_cota_index = (("0" + $('#biblioteca_tegbundle_teg_cota_index').val()).slice (-2));
            }
            
            $('#cota_escuela').text("D"+prev_cota_escuela);
            $('#cota_year').text(prev_cota_year);

            $('#biblioteca_tegbundle_teg_cota').val("D"+prev_cota_escuela+"-"+prev_cota_index+"-"+prev_cota_year);
        });

    });
   
    </script>
{% endblock %}
